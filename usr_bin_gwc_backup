#!/bin/bash
# Launcher principal de GhostWhisperChat

export PYTHONPATH=$PYTHONPATH:/usr/lib

if [ "$1" == "--start" ]; then
    echo "Iniciando Demonio..."
    # Usamos exec para reemplazar el proceso shell por el demonio python
    # Esto evita que systemd mate el proceso al salir el script
    exec python3 -u -m ghostwhisperchat.demonio
fi

if [ "$1" == "--check" ]; then
    python3 -m ghostwhisperchat.core.diagnostico
    exit 0
fi

if [ "$1" == "--update" ] || [ "$1" == "update" ]; then
    echo "=========================================="
    echo "ðŸ”„ ACTUALIZAR GHOSTWHISPERCHAT"
    echo "=========================================="
    
    echo "[*] Buscando actualizaciones en red..."
    if sudo apt update; then
        echo "[*] Instalando ultima versiÃ³n..."
        if sudo apt install --only-upgrade ghostwhisperchat -y; then
            echo "[*] Reiniciando servicio..."
            systemctl --user restart ghostwhisperchat
            echo "âœ… ActualizaciÃ³n completada."
            gwc version
            exit 0
        else
            echo "[X] Error al instalar la actualizaciÃ³n."
            exit 1
        fi
    else
        echo "[X] Error al actualizar la lista de paquetes."
        exit 1
    fi
fi

# Default: Cliente
python3 -m ghostwhisperchat.cliente "$@"
